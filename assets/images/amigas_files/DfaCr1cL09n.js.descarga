if (self.CavalryLogger) { CavalryLogger.start_js(["rsf5P"]); }

__d("MessengerTabsThreadSearchStore",["cx","ImmutableObject","MercurySearchContextResults","MercurySearchSnippetResults","MercurySingletonProvider","MessengerState.bs","MessengerStore","MessengerThreadSearchActions","gkx","immutable"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("immutable").List;d=b("immutable").Record;var i=d({downExhausted:null,loading:!1,messages:null,results:c(),selectedIndex:0,threadID:null,upExhausted:null,mid:null});f=babelHelpers.inherits(a,b("MessengerStore"));h=f&&f.prototype;function a(a){h.constructor.call(this),this.$MessengerTabsThreadSearchStore1={},this.$MessengerTabsThreadSearchStore3=a,this.$MessengerTabsThreadSearchStore2=new(b("MercurySearchSnippetResults"))(a)}a.get=function(){return j.get()};a.prototype.getThreadState=function(a){a=this.$MessengerTabsThreadSearchStore1[a];return a?a:new i()};a.prototype.__onDispatch=function(a){__p&&__p();if(!this.$MessengerTabsThreadSearchStore2)return;var c=a.threadID;if(!c)return;switch(a.type){case b("MessengerThreadSearchActions").Types.UPDATE_THREAD_STATE:var d=a.mid;if(!d){this.$MessengerTabsThreadSearchStore1[c]=new i();this.emitChange();return}var e=this.$MessengerTabsThreadSearchStore1[c];e||(e=new i());if(d!=e.mid){this.$MessengerTabsThreadSearchStore1[c]=e.merge({threadID:c,mid:d});b("MercurySearchContextResults").getSearchContext(this.$MessengerTabsThreadSearchStore4(c),c,function(a){return this.setMessagesForThread(a,c)}.bind(this));return}break;case b("MessengerThreadSearchActions").Types.GET_MORE_CONTEXT:if(!this.$MessengerTabsThreadSearchStore1[c])return;this.$MessengerTabsThreadSearchStore1[c]=this.$MessengerTabsThreadSearchStore1[c].set("loading",!0);b("MercurySearchContextResults").getMoreSearchContext(this.$MessengerTabsThreadSearchStore4(c),c,a.direction,function(a){return this.setMessagesForThread(a,c)}.bind(this));this.emitChange();break}};a.prototype.setMessagesForThread=function(a,c){__p&&__p();var d=this.$MessengerTabsThreadSearchStore1[c];d||(d=new i());if(a.down_exhausted){if(this.$MessengerTabsThreadSearchStore1[c].messages){var e=this.$MessengerTabsThreadSearchStore1[c].messages.map(function(a){return a.message_id}).toArray();b("MessengerState.bs").invalidateSearchedMessages(this.$MessengerTabsThreadSearchStore3,e)}this.$MessengerTabsThreadSearchStore1[c]=new i();this.emitChange();return}e=b("MessengerState.bs").getMessagesFromIDs(this.$MessengerTabsThreadSearchStore3,[].concat(a.up_message_ids,a.message_id,a.down_message_ids)).map(function(c){if(c&&c.message_id===a.message_id)if(!d.results.isEmpty()){var e=d.results.get(d.selectedIndex).toJS(),f=e.matched_keywords,g=c.body.indexOf(e.body);e=Object.keys(e.matched_keywords).map(function(a){return{offset:g+Number(a),length:f[a].length,entity:{url:""},className:"__in"}});return new(b("ImmutableObject"))(babelHelpers["extends"]({},c,{ranges:c.ranges?c.ranges.concat(e):e}))}else return new(b("ImmutableObject"))(babelHelpers["extends"]({},c,{isSelected:!0}));return new(b("ImmutableObject"))(babelHelpers["extends"]({},c))});this.$MessengerTabsThreadSearchStore1[c]=d.merge({downExhausted:a.down_exhausted,loading:!1,messages:e,upExhausted:a.up_exhausted});this.emitChange()};a.prototype.$MessengerTabsThreadSearchStore4=function(a){a=this.$MessengerTabsThreadSearchStore1[a];return!a?"":a.mid||a.results.getIn([a.selectedIndex,"message_id"])};var j=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("InstreamAdsCPVUpsellExpCellType",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({NO_UPSELL:"no_upsell",ABOVE_PLACEMENT:"above_placement",BELOW_PLACEMENT:"below_placement",INSIDE_PLACEMENT:"inside_placement"})}),null);